<!-- START -->
<!-- html header, styling for Tutorials pages -->
<!-- note: requires stylesheet.css to be in the parent directory; see <head> section -->
<!-- copy the contents below into the appropriate sections of your html page -->

<!-- document setup -->

<html>

<!-- head area -->
<head>
<!-- <meta charset="utf-8" /> --> <!-- old version -->
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- set the viewport https://www.w3schools.com/css/css_rwd_viewport.asp -->
<title>Tutorials - HNN</title>
<!-- import CSS style sheet from Github directory -->
<link rel = "stylesheet" type = "text/css" href = "../html-styling/stylesheet.css" />
</head>

<!-- body styling -->
<body>

<!-- add Navbar -->
<div class="navbar">
  <div id="wrapper">
    <img src="https://hnn.brown.edu/wp-content/uploads/2018/05/mainlogo3.png" alt="HNN" scale="0">
    <a href="https://hnn.brown.edu/index.php/tutorials/#jumptutorials">TUTORIALS</a>
    <a href="https://hnn.brown.edu">HOME</a>
  </div>
</div>

<!-- add Tutorials header -->
<div class="headercontainer main">
<div class="headertext">  </div>
</div>

<!-- set width for body to 900px -->
<div id="wrapper">

<!-- add button to scroll to top -->
<button onclick="topFunction()" id="myBtn" title="Scroll to top">Top</button>

<!-- script for scroll button function -->
<script>
//Get the button:
mybutton = document.getElementById("myBtn");
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};
function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
</script>

<!-- return to tutorials page -->
<div style="text-align:center; vertical-align: middle; padding:10px;">
<p></p>

<tbody>
<tr style="border: none;">
<td style="border: none; width: 33.3%; padding: 1px;">
</td>

<td style="border: none; width: 33.3%; padding: 1px;">
<!--<a style="text-decoration: none" href="https://hnn.brown.edu/index.php/tutorials/">-->
<p><img src="https://hnn.brown.edu/wp-content/uploads/2019/06/EEG_Brain.png" width="60" height="auto"></p>
<p style=" font-family: sans-serif; font-size: x-large; font-weight:700; color: #1156a3; border:0px; margin:0px;">Tutorials</p>
<!--</a>-->
</td>

<td style="border: none; width: 33.3%; padding: 1px;">
</td>
</tr>
</tbody>
</div>

<!-- your contents go here -->

<!-- </body> -->
<!-- </html> -->
<!-- END -->
<h1 id="event-related-potentials-erps">Event Related Potentials (ERPs)</h1>
<h2 id="getting-started">Getting Started</h2>
<p>In order to understand the workflow and initial parameter sets provided with this tutorial, we must first briefly describe prior studies that led to the creation of the provided data and evoked response parameter set that you will work with. This tutorial is based on results from our 2007 study where we recorded and simulated tactile evoked responses source localized to the primary somatosensory cortex (SI) [1].</p>
<p>In our 2007 study, we investigated the early evoked activity (0-175 ms) elicited by a brief tap to the D3 digit and source localized to an an equivalent current dipole in the contralateral hand area of the primary somatosensory cortex (SI) [1]. The strength of the tap was set at either suprathreshold (100% detection probability) or perceptual threshold (50% detection) levels (see Figure 1, left panel below). Note, to be precise, this data represents source localized event related field (ERF) activity because it was collected using MEG. We use the terminology ERP for simplicity, since the primary current dipoles generating evoked fields and potentials are the same.</p>
<p>We found that we could reproduce evoked responses that accurately reflected the recorded waveform in our neocortical model from a layer specific sequence of exogenous excitatory synaptic drive to the local SI circuit, see Figure 1right panel below. This drive consisted of “feedforward” / proximal input at ~25 ms post-stimulus, followed by “feedback” / distal input at ~60 ms, followed by a subsequent “feedforward” / proximal input at ~125 ms (Gaussian distribution of input times on each simulated trial). This sequence of drive generated spiking activity and intracellular dendritic current flow in the pyramidal neuron dendrites to reproduce the current dipole signal. This sequence of drive can be interpreted as initial “feedforward” input from the lemniscal thalamus, followed by “feedback” input from higher order cortex or non-lemniscal thalamus, followed by a re-emergent leminsical thalamic drive. Intracranial recordings in non-human primates motivated and supported this assumption [2].</p>
<p>In our model, the exogenous driving inputs were simulated as predefined trains of action potentials (pre-synaptic spikes) that activated excitatory synapses in the local cortical circuit in proximal and distal projection patterns (i.e. feedforward, and feedback, respectively, as shown schematically in Figure 1 right, and in the HNN GUI Model Schematics). The number, timing and strength (post-synaptic conductance) of the driving spikes were manually adjusted in the model until a close representation of the data was found (all other model parameters were tuned and fixed based on the morphology, physiology and connectivity within layered neocortical circuits [1]. Note, a scaling factor was applied to net dipole output to match to the magnitude of the recorded ERP data and used to predict the number of neurons contributing to the recorded ERP (purple circle, Figure 1, right panel). The dipole units were in nAm, with a one-to-one comparison between data and model output due to the biophysical detail in our model.</p>
<div style="display:block; width:100%; margin: 0 auto;">
<figure>
<img src="../erp/images/image8.png" alt="" /><figcaption>Figure 1</figcaption>
</figure>
</div>
<p style="text-align:justify; display: block; margin: 0 auto;width: 90%; font-size: 1em;">
Adapted from Jones et al. 2007 [1]. Comparison of SI evoked response in experiment and neural model simulation. Left: MEG data showing tactile evoked response (ERP) source localized to the hand area of SI. Red: suprathreshold stimulation; Blue: Threshold stimulation (avg. n=100 trials). Right: Neural model simulation depicting proximal/distal inputs needed to replicate the ERP waveform (avg. n=25 trials)
</p>
<p>In summary, to simulate the SI evoked response, a sequence of exogenous excitatory synaptic drive was simulated (by creating presynaptic spikes that activate layer specific synapses in the neocortical network) consisting of proximal drive at ~25 ms, followed by distal drive at ~60 ms, followed by a second proximal drive at ~122 ms. Given this background information, we can now walk you through the steps of simulating a similar ERP, using a subset of the data shown in Figure 1.</p>
<h2 id="tutorial-table-of-contents">Tutorial Table of Contents</h2>
<ol type="1">
<li><p><a href="#toc_1">Load/view data</a></p></li>
<li><p><a href="#toc_2">Load/view parameters to define network structure &amp; to “activate” the network</a></p></li>
<li><p><a href="#toc_3">Running the simulation and visualizing net current dipole</a></p></li>
<li><p><a href="#toc_4">A closer look inside the simulations: contribution of layers and cell types</a></p></li>
<li><p><a href="#toc_5">Comparing model output and recorded data</a></p></li>
<li><p><a href="#toc_6">Adjusting parameters</a></p></li>
<li><p><a href="#toc_7">Have fun exploring your own data!</a></p></li>
<li><p><a href="#toc_8">Additional documents</a></p>
<p>8.1. <a href="#toc_8.1">Parameter files</a></p>
<p>8.2. <a href="#toc_8.2">Video walkthrough (2018)</a></p></li>
</ol>
<p><a id="toc_1"></a></p>
<h2 id="loadview-data">1. Load/view data</h2>
<p>An example ERP dataset is provided in the <a href="https://github.com/jonescompneurolab/hnn-data">hnn-data GitHub repository</a>. We use the data as an orienting example for where to begin to simulate an ERP.</p>
<p>This dataset represents early evoked activity (0-175 ms) from an equivalent current dipole source localized to the hand area of the primary somatosensory cortex (SI), elicited by a brief perceptual threshold level tap to the contralateral D3 digit (read Getting Started above for details). The example dataset provided was collected at 600Hz and contains only averaged data from 100 trials in which the tap was detected. (Note, when loading your own data, if it was not collected at 600Hz, you must first downsample to 600Hz to view it in the HNN GUI).</p>
<p>To load and view this data, navigate to the main GUI window and on the bottom left corner click: <code>Load data</code></p>
<p>If you have cloned the hnn-data repository, navigate to hnn-data folder on your desktop and select <code>MEG_detection_data/yes_trial_S1_ERP_all_avg.txt</code>. HNN will then load the data and display the waveform in the dipole window as shown below.</p>
<p>Alternatively, if you have not cloned the hnn-data repository, you can download the file directly by clicking <a href="https://github.com/jonescompneurolab/hnn/blob/master/data/MEG_detection_data/yes_trial_S1_ERP_all_avg.txt">here</a>.</p>
<div style="display:block; width:90%; margin: 0 auto;">
<h3 id="figure-2">Figure 2</h3>
<p><img src="images/erp_fig_02.png" /></p>
</div>
<p>Note, the software can be used without loading data. If you wish to play with simulations without data, proceed to Step 2 first.</p>
<p><a id="toc_2"></a></p>
<h2 id="loadview-parameters-to-define-network-structure-to-activate-the-network">2. Load/view parameters to define network structure &amp; to “activate” the network</h2>
<p>An initial parameter set that will simulate the evoked drives that generate an evoked response in close agreement with the SI data described in Step 1 is distributed in the hnn-data repository. Click on the <code>External drives</code> tab at the top of the GUI and then click the <code>Load external drives</code> button. Navigate to the <code>hnn-data/network-configurations</code> folder on your computer and select ‘ERPYesTrials.param’, or click <a href="">here</a> to download the parameter file directly and load it into the GUI.</p>
<div style="display:block; width:90%; max-width:500px; margin: 0 auto;">
<h3 id="figure-3">Figure 3</h3>
<p><img src="images/erp_fig_03.png" /></p>
</div>
<p>The template cortical column networks structure for this simulation is described in the <a href="https://hnn.brown.edu/under-the-hood/">“HNN Template Model” page</a> on the hnn.brown.edu website. Several of the network parameter can be adjusted via the HNN GUI (e.g., local excitatory and inhibitory connection strengths) under the <code>Network connectivity</code> tab, but we will leave them fixed for this tutorial and only adjust the inputs that “activate” the network.</p>
<p>The values of the parameters that you loaded to “activate” the network in a manner that will generate an evoked response can now be viewed under the <code>External drives</code> tab. As described in the “Getting Started” section, the evoked response can be simulated with a sequence of exogenous driving inputs consisting of a proximal input at ~26 ms (evprox1), followed by a distal input at ~64 ms (evdist1), followed by a subsequent proximal input at ~137 ms (evprox).</p>
<p>To see the detailed parameter values defining each of these drives click on the dropdown button next to the name of each drive. Note: additional evoked proximal or distal inputs can be added to your simulation for your hypothesis testing goals by using the <code>Add drive</code> button and specifying the drive as “Evoked” and the location as either “proximal” or “distal”. Other types of drives can also be defined including poisson, rhythmic, and tonic, as detailed in other tutorials.</p>
<p>Each evoked input consists of a Gaussian distributed train of presynaptic action potentials that will target all of the cells in the post-synaptic network, with several adjustable parameters, including the mean arrival and standard deviation of the time each spike activates the network (in milliseconds), the number of the driving spikes on each trial of the simulation, and a random number seed that enables reproducibility of simulation results across trials. You can also adjust the postsynaptic conductance of the drive onto the postsynaptic cell. For example, under the “AMPA weights” section in the “evprox1” dropdown menu, the L5_pyramidal field represents the the post synaptic AMPA conductance of the proximal input onto the layer 5 pyramidal neuron at each location targeted by the proximal drive. Note that the Synchronous Inputs checkbox allows specification of whether each cell/synapse receives inputs at the same time or whether each cell/synapse receive inputs independently. In either case, the synaptic input times are drawn from the same distribution. Schematic representations of the postsynaptic location of each input is shown below. For further details on the connectivity structure of the network, see the <a href="https://hnn.brown.edu/under-the-hood/">“HNN Template Model”</a> page.</p>
<div class="stylefig">
<table>
<h3>
Figure 4
</h3>
<tr>
<td>
<div style="max-width:500px;">
<figure>
<img src="images/erp_fig_04_01.png" alt="" /><figcaption>Figure 4a</figcaption>
</figure>
</div>
</td>
<td>
<div style="max-width:500px;">
<figure>
<img src="images/erp_fig_04_02.png" alt="" /><figcaption>Figure 4a</figcaption>
</figure>
</div>
</td>
</tr>
</table>
</div>
<p><a id="toc_3"></a></p>
<h2 id="running-the-simulation-and-visualizing-net-current-dipole">3. Running the simulation and visualizing net current dipole</h2>
<p>Now that we have an initial parameter set, we can run a simulation for a set number or trials. Let’s start by defining 3 trials, by clicking on the simulation tab and defining Trials=3. On each simulated trial, the timings of the evoked inputs (i.e., spikes) are chosen from a Gaussian distribution with mean and stdev (standard deviation) as defined in the “Evoked drives” tap. Histograms of each of the evoked inputs will be displayed at the top of the Figure tab after the simulations run.</p>
<p>Before running the simulation, we’ll first change the simulation name (i.e., the name under which the simulated data will be saved) to a new descriptive-name for the simulation here. Under the ‘Simulation’ tab change ‘Name’ from default to ERPyes-1trial. Note the default simulation is in fact 1 run of the ERP yes simulation. There are several other adjustable simulate parameters, in the ‘Simulation’ tab. These parameters control the duration (stop), integration time step (dt), number of trials (Trials), and the choice of the simulation backend of either MPI (parallel across neurons) or Joblib (parallel across trials), assuming both backends are installed.</p>
<p>Hit ’Run" button to run the simulation. A simulation log is shown under the Run button that will tell you the status of your simulaion.</p>
<p>Once complete, a new Figure 2 window will appear showing the output of the simulation as in the figure below. The thin blue traces are net current dipole signals from individual trials while the thick blue trace is the average ERP, with histograms of the proximal and distal driving spikes shown above.</p>
<p>To view the simulation on top of the data and examine the goodness of fit, click on the ‘Visualization’ tab. Under Figure 2 you will see that Figure 2 has two subplots defined by ax0 and ax1. ax0 describes the adjustable features of the histogram subplot, while ax1 describes the adjustable features of the net current dipole subplot. Note you can change what is shown in either of these subplots by selecting ‘clear axis’, picking the ‘Type’ of data from the pulldown menu, and clicking ‘Add plot’. For now, we’re going to continue to visualize the net current dipole plot.</p>
<p>To overlay the data shown in Figure 1 in Figure 2, go to Figure 2 and select ax1. in the ‘Data to Compare:’ pull down menu choose yes_trial_S1_ERP_all_avg, then click add plot. The data will now be overlaid in Figure 2 with the root mean square error (RMSE) displayed.</p>
<p>You can remove the data or simulation output from the figure by clicking "clear axis’</p>
